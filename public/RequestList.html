<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="img/ZappnottLogo.png" type="image/icon">
    <title>Requests</title>
</head>
<style>
    @keyframes fadeInRight {
    0% {
        opacity: 1;
        transform: translateX(0%);
    }
    100% {
        opacity: 0;
        transform: translateX(-15%);
    }
    }
    .animation-fadeInRight {
    animation: fadeInRight 0.15s ease-in-out forwards;
    }
    @keyframes fadeInLeft {
    0% {
        opacity: 0;
        transform: translateX(-40%);
    }
    100% {
        opacity: 1;
        transform: translateX(0);
    }
    }
    .animation-fadeInLeft {
    animation: fadeInLeft 0.5s ease-in-out forwards;
    }
</style>
<body>
    <div class="bg-Likha h-[5rem] w-full shadow-md p-2.5 fixed z-50">
        <nav class="md:flex md:items-center">   
            <div >
                <img src="img/ZappnottLogo.png" alt="" class="h-[4rem] ml-[2rem] cursor-pointer md:cursor-default" onclick="Menu(this)" name = "menu" id="menubutton">
            </div>

            <ul class="my-6 md:my-0 ml-10">
                <a href="Inbox.html" class="relative hover:text-outline duration-300">
                    CHAT
                    <!-- <span id="notif-badge" class="absolute top-0 right-[-1] inline-flex items-center justify-center py-1 text-xs font-bold leading-none text-sign bg-outline rounded-full"></span> -->
                </a>
            </ul>
            
            
            <div class="flex fixed p-3 top-1 right-1 md:right-16">
                <img id="Profile" class="cursor-pointer h-[3rem] w-[3rem]" src="img/PROFILE.png"  alt="">
            </div>
        </nav>
    </div>
    <div class="bg-Likha min-h-screen pt-[5rem] pb-[3rem]">
        
        <div id="SideBar" class="bg-[#F8ECDC] h-svh w-[80px] z-[1000] fixed flex flex-col">
            <div id="Open" class="bg-[#F8ECDC] w-[30px] h-[60px] absolute right-[-1.25rem] top-[23rem] rounded-xl items-center flex justify-center shadow-xl cursor-pointer -z-50">></div>
            <div class="relative h-[47.5rem] space-y-32">
                <div class=" h-[30rem] w-auto mx-2 mt-[6rem] flex flex-col justify-between">
                    <a href="DashboardAd.html" class="cursor-pointer mx-1 h-[50px] w-auto flex items-center hover:bg-[#f7997ae2]  rounded-2xl duration-200">
                        <img id="Logo" class="w-[60px] h-[55px]" src="img/dashboard.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Dashboard</h1>
                    </a>
                    <a class=" h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="OrderList.html">
                        <img class="w-[55px] h-[55px]" src="img/ordermenu.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Order</h1>
                    </a>
                    <a class="  h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="RequestList.html">
                        <img class="w-[55px] h-[55px]" src="img/request.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Request</h1>
                    </a>
                    <a class=" h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="AdminProducts.html">
                        <img class="w-[55px] h-[55px]" src="img/product.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Products</h1>   
                    </a>
                    <a class="relative h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2] rounded-2xl duration-200" href="Materials.html">
                        <img class="w-[55px] h-[55px]" src="img/materialslogo.png" alt=""></img>
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Materials</h1>
                    </a>
                    <a class="relative h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2] rounded-2xl duration-200" href="Inbox.html">
                            <img class="w-[55px] h-[55px]" src="img/mesage.png" alt=""></img>
                            <span id="notif-badge" class="absolute top-0 left-9 w-3 h-3 inline-flex items-center justify-center text-[8px] font-bold text-[#FFFFFF] bg-[#FF0000] rounded-full"></span>
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Message</h1>
                    </a>
                </div>
                <div class="relative bottom-0 h-[50px] w-auto mx-1">
                    <hr class=" w-auto border-1 border-outline mx-1">
                    <div class="flex items-center cursor-auto" onclick="LogOut()">
                        <img src="img//LogOuts.png" alt="" class="cursor-pointer h-[50px] w-[50px] mx-2">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold opacity-0">LogOut</h1>
                    </div>
                </div>
            </div>
            
            
        </div>

        <div class="text-center mt-3">
            <H1 class="font-Montagu text-4xl font-bold">3D Requests</H1>
        </div>
        <div class="mt-9 flex mx-[10rem] justify-around">
            <div class="cursor-pointer w-[272.45px] rounded-2xl h-[68.2px] bg-sign outline-[3px] outline outline-outline">
                <p class="font-Montserrat text-sm text-center text-[#00000080] font-semibold">All Request</p>
                <img src="img/AllReq.png" class="w-[3rem] absolute top-[11.5rem] ml-3" alt="">
            </div>
            <div class="cursor-pointer w-[275.76px] rounded-2xl h-[68.2px] bg-sign outline-[3px] outline outline-outline">
                <p class="font-Montserrat text-sm text-center text-[#00000080] font-semibold">Confirmed Request</p>
                <img src="img/ConfirmedReq.png" class="w-[3rem] absolute top-[11.5rem] ml-3" alt="">
            </div>
            <div class="cursor-pointer w-[275.76px] rounded-2xl h-[68.2px] bg-sign outline-[3px] outline outline-outline">
                <p class="font-Montserrat text-sm text-center text-[#00000080] font-semibold">Ready to Pick Up</p>
                <img src="img/Ready to Pick Up.png" class="w-[3rem] absolute top-[11.5rem] ml-3" alt="">
            </div>
        </div>

        <div class="mt-[3rem] ml-[14rem] flex items-center space-x-8">
            <div class="items-center relative w-[853px] pt-[1.35rem] px-[1rem] h-[90px] bg-sign outline outline-2 outline-outline rounded-lg">
                <input type="text" id="SearchBar" class="p-2 w-[822px] h-[50px] rounded-lg bg-Likha focus:outline-none focus:ring-1 focus:ring-outline">
                <img src="img/SEARCH BAR.png" class="w-[50px] absolute right-4 top-[1.35rem] " alt="">
            </div>
            <div id="Filter" class="cursor-pointer relative flex px-6 space-x-9 items-center w-[174.4px] h-[60px] bg-sign outline outline-2 outline-outline rounded-lg">
                <div class="space-y-2 relative ">
                    <img id="FilterImage" src="img/58.png" alt="">
                </div>
                <div>
                    <p class="font-Montserrat font-semibold text-[#00000080]">Filter</p>
                </div>
            </div>
        </div>

        <div class="mx-[6rem] mt-[3rem] relative w-auto h-auto rounded-lg bg-sign outline outline-[3px] outline-outline p-7">
            <div class="items-center flex w-auto h-[50px] bg-Likha rounded-lg justify-between pr-[20rem] pl-[4rem]">
                <h1 class="font-Montserrat font-semibold text-[16px] text-[#00000080]">Request ID</h1>
                <h1 class="font-Montserrat font-semibold text-[16px] text-[#00000080]">Date</h1>
                <h1 class="font-Montserrat font-semibold text-[16px] text-[#00000080]">Customer Name</h1>
                <h1 class="font-Montserrat font-semibold text-[16px] text-[#00000080] mr-[4.5rem]">Total</h1>
                <h1 class="font-Montserrat font-semibold text-[16px] text-[#00000080] relative">Status</h1>
            </div>
            <div id="RequestList" ></div>
        </div>


        <!-- <div id="AdminMenu" class="bg-[#F8ECDC] outline hidden fixed outline-[3px] p-0 outline-outline w-[491px] h-[320px]  right-[0.15rem] top-[5.15rem] flex flex-col justify-evenly">
            <a href="OrderList.html" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
                <p class="font-Montserrat font-semibold">Order</p>
            </a>
            
            <a href="" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
                <p class="font-Montserrat font-semibold">Landing</p>
            </a>
            <a href="AdminHome.html" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
                <p class="font-Montserrat font-semibold">Home Page</p>
            </a>
            <a href="" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
                <p class="font-Montserrat font-semibold">3D Customization</p>
            </a>
            <a href="" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
                <p class="font-Montserrat font-semibold">Log Out</p>
            </a>
        </div> -->
    </div>

</body>
<script>

async function fetchUnreadCount() {
        try {
            const response = await fetch('/ChatNotif'); 
            const data = await response.json();
            const unreadCount = data.Notif;
            console.log(unreadCount);
            const notifBadge = document.getElementById('notif-badge');
            if (unreadCount > 0) {
                notifBadge.textContent = unreadCount;
                notifBadge.style.display = 'inline-flex';
            } else {
                notifBadge.style.display = 'none';
            }
        } catch (error) {
            console.error('Error fetching unread count:', error);
        }
    }


    document.addEventListener('DOMContentLoaded', fetchUnreadCount);


    setInterval(fetchUnreadCount, 2000); 


const SideBar = document.getElementById('SideBar');
const Open = document.getElementById('Open');
const Logo = document.getElementById('Logo');
const Brand = document.querySelectorAll('#Brand');

Open.addEventListener('click', function(event){
    SideBar.classList.add('transition-all', 'duration-500');
    if(SideBar.classList.contains('w-[80px]')){
        Brand.forEach(brand =>{brand.classList.remove('hidden')});
        Brand.forEach(brand =>{brand.classList.add('animation-fadeInLeft')});
        SideBar.classList.add('w-[350px]');
        SideBar.classList.remove('w-[80px]');
        Open.innerText = '<';
    }
    else if(SideBar.classList.contains('w-[350px]')){
        Brand.forEach(brand =>{brand.classList.remove('animation-fadeInLeft')});
        Brand.forEach(brand =>{brand.classList.add('hidden')});
        Brand.forEach(brand =>{brand.classList.add('animation-fadeInRight')});
        SideBar.classList.add('w-[80px]');
        SideBar.classList.remove('w-[350px]');
        Open.innerText = '>';
    }
});

let isDescending = true;

document.getElementById('Filter').addEventListener('click', () => {
    isDescending = !isDescending;
    
    const filterImage = document.getElementById('FilterImage');
    filterImage.src = isDescending ? 'img/58.png' : 'img/57.png';
    
    fetchRequest();
});

async function fetchRequest(query = '') {
    const sortOrder = isDescending ? 'desc' : 'asc';
    const response = await fetch(`/Request?search=${query}&sortOrder=${sortOrder}`);
    const items = await response.json();

    const itemList = document.getElementById('RequestList');
    itemList.innerHTML = '';

    items.forEach(Item => {
        const itemElement = document.createElement('div');
        itemElement.innerHTML = `
                <div class="mt-5 relative items-center flex w-auto h-[50px] bg-Likha rounded-lg">
                <div id="ProdCon" class="w-[10rem] text-center item-center h-[2rem] absolute left-[1.25rem]">
                    <h2 id="Transac" class="relative text-[#6B707B] font-Inter font-extrabold text-[14px]">${Item.ProductID}</h2>
                </div>
                <div class="w-[10rem] text-center item-center h-[2rem] absolute left-[12.5rem]">
                    <h2 class="relative font-Montserrat font-semibold text-[14px]">${Item.Dates}</h2>
                </div>
                <div class="w-[15rem] text-center item-center h-[2rem] absolute left-[22.5rem]">
                    <h2 class="relative font-Montserrat font-semibold text-[14px]">${Item.Name || 'N/A'}</h2>
                </div>
                <div class="w-[10rem] text-center item-center h-[2rem] absolute right-[30.75rem]">
                    <h2 class="relative font-Montserrat mx-auto font-semibold text-[14px]">${Item.TotalPrice}</h2>
                </div>
                <div class="absolute flex items-center justify-center right-[18.5rem] w-[90px] h-[25px] rounded-2xl">
                    <p id="Status" class="relative font-Montserrat font-semibold text-center text-xs truncate ">${Item.Status}</p>
                </div>
                <div id="View" class="absolute cursor-pointer right-[7rem] w-[100px] top-[0.75rem] h-[25px] rounded-2xl bg-[#032D7E80] outline outline-[3px] outline-[#032D7E]">
                    <p class="font-Montserrat text-[#032D7E] font-semibold text-center text-sm" >View Details</p>
                </div>
            </div>
        `;
        itemList.appendChild(itemElement);
        
        const statusDiv = itemElement.querySelector('#Status');

        async function checkStat(){
            const Status = Item.Status;

            if(Status === 'Requested'){
                statusDiv.classList.add('text-[#FFC107]'); 
            }
            else if(Status === 'Confirmed'){
                statusDiv.classList.add('text-[#228B22]'); 
            }
            else if(Status === 'On Process'){
                statusDiv.classList.add('text-[#00BFFF]'); 
            }
            else if(Status === 'Ready for Pick Up'){
                statusDiv.classList.add('text-[#032D7E]');
            }
            else if(Status === 'Declined'){
                statusDiv.classList.add('text-[#FF0000]'); 
            }
            else if(Status === 'Completed'){
                statusDiv.classList.add('text-[#008080]'); 
            }
            else if(Status === 'Paid '){
                statusDiv.classList.add('text-[#6A0DAD]'); 
            }
        }

        checkStat();

        const viewButton = itemElement.querySelector('#View');
        viewButton.addEventListener('click', () => {

            const transacValue = itemElement.querySelector('#Transac').textContent;
            console.log('RequestID: ',transacValue);

            sessionStorage.setItem('RequestID', transacValue);

            window.location.href = 'RequestDetail.html';
        });

    });
}

// async function fetchRequest(query = '') {
//     console.log(`/Request?search=${query}`);
//     fetch(`/Request?search=${query}`)
//     .then(response => response.json())
//     .then(Items => {
//         console.log(Items);
//         Items.forEach(Item => {
//             const ItemList = document.getElementById('RequestList');
//             const ItemElement = document.createElement('div');
//             ItemElement.innerHTML = `
//             <div class="mt-5 relative items-center flex w-auto h-[50px] bg-Likha rounded-lg">
//                 <div id="ProdCon" class="w-[10rem] text-center item-center h-[2rem] absolute left-[1.25rem]">
//                     <h2 id="Transac" class="relative text-[#6B707B] font-Inter font-extrabold text-[14px]">${Item.ProductID}</h2>
//                 </div>
//                 <div class="w-[10rem] text-center item-center h-[2rem] absolute left-[12.5rem]">
//                     <h2 class="relative font-Montserrat font-semibold text-[14px]">${Item.Dates}</h2>
//                 </div>
//                 <div class="w-[15rem] text-center item-center h-[2rem] absolute left-[22.5rem]">
//                     <h2 class="relative font-Montserrat font-semibold text-[14px]">${Item.Name || 'N/A'}</h2>
//                 </div>
//                 <div class="w-[10rem] text-center item-center h-[2rem] absolute right-[30.75rem]">
//                     <h2 class="relative font-Montserrat mx-auto font-semibold text-[14px]">${Item.TotalPrice}</h2>
//                 </div>
//                 <div class="absolute flex items-center justify-center right-[18.5rem] w-[90px] h-[25px] rounded-2xl">
//                     <p id="Status" class="relative font-Montserrat font-semibold text-center text-xs truncate ">${Item.Status}</p>
//                 </div>
//                 <div id="View" class="absolute cursor-pointer right-[7rem] w-[100px] top-[0.75rem] h-[25px] rounded-2xl bg-[#032D7E80] outline outline-[3px] outline-[#032D7E]">
//                     <p class="font-Montserrat text-[#032D7E] font-semibold text-center text-sm" >View Details</p>
//                 </div>
//             </div>
//             `;
//             ItemList.appendChild(ItemElement);

           
//         });
//     });
// }

const searchBar = document.getElementById('SearchBar');

searchBar.addEventListener('input', (event) => {
const query = event.target.value;
fetchRequest(query);
});

fetchRequest();

    // async function fetchUnreadCount() {
    //     try {
    //         const response = await fetch('/ChatNotif'); 
    //         const data = await response.json();
    //         const unreadCount = data.Notif;
    //         console.log(unreadCount);
    //         const notifBadge = document.getElementById('notif-badge');
    //         if (unreadCount > 0) {
    //             notifBadge.textContent = unreadCount;
    //             notifBadge.style.display = 'inline-flex';
    //         } else {
    //             notifBadge.style.display = 'none';
    //         }
    //     } catch (error) {
    //         console.error('Error fetching unread count:', error);
    //     }
    // }


    // document.addEventListener('DOMContentLoaded', fetchUnreadCount);


    // setInterval(fetchUnreadCount, 2000); 

</script>
<script src="Refresh.js"></script>
<script src="AuthorizationBE.js"></script>
<script src="AdminPage.js"></script>
</html>