<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="img/ZappnottLogo.png" type="image/icon">
    <title>Dashboard</title>
</head>
<style>
        @keyframes fadeInRight {
    0% {
        opacity: 1;
        transform: translateX(0%);
    }
    100% {
        opacity: 0;
        transform: translateX(-15%);
    }
    }
    .animation-fadeInRight {
    animation: fadeInRight 0.15s ease-in-out forwards;
    }
    @keyframes fadeInLeft {
    0% {
        opacity: 0;
        transform: translateX(-40%);
    }
    100% {
        opacity: 1;
        transform: translateX(0);
    }
    }
    .animation-fadeInLeft {
    animation: fadeInLeft 0.5s ease-in-out forwards;
    }
#SoldOut::-webkit-scrollbar,
#Best::-webkit-scrollbar {
    height: 3px;
    width: 5px; 
    border-radius: 10px;
}

#SoldOut::-webkit-scrollbar-thumb,
#Best::-webkit-scrollbar-thumb {
    background-color: rgba(103, 103, 103, 0.5);
    border-radius: 10px; 
}

#SoldOut::-webkit-scrollbar-thumb:hover,
#Best::-webkit-scrollbar-thumb:hover {
    background-color: rgba(46, 46, 46, 0.7); 
}

#SoldOut::-webkit-scrollbar-track,
#Best::-webkit-scrollbar-track {
    background: none;
    border-radius: 60px; 
}

</style>
<body>
    <div class="bg-Likha h-[5rem] w-full shadow-md p-2.5 fixed z-50">
        <nav class="md:flex md:items-center">   
            <div >
                <img src="img/ZappnottLogo.png" alt="" class="h-[4rem] ml-[2rem] cursor-pointer md:cursor-default" onclick="Menu(this)" name = "menu" id="menubutton">
            </div>

            <ul class="my-6 md:my-0 ml-10">
                <a href="Inbox.html" class="relative hover:text-outline duration-300">
                    CHAT
                    <!-- <span id="notif-badge" class="absolute top-0 right-[-1] inline-flex items-center justify-center py-1 text-xs font-bold leading-none text-sign bg-outline rounded-full"></span> -->
                </a>
            </ul>
            
            
            <div class="flex fixed p-3 top-1 right-1 md:right-16">
                <img id="Profile" class="cursor-pointer h-[3rem] w-[3rem]" src="img/PROFILE.png"  alt="">
            </div>
        </nav>
    </div>
    <div class="bg-Likha min-h-screen pt-[5rem] pb-[3rem]">
        <div id="SideBar" class="bg-[#F8ECDC] h-svh w-[80px] z-[1000] fixed flex flex-col">
            <div id="Open" class="bg-[#F8ECDC] w-[30px] h-[60px] absolute right-[-1.25rem] top-[23rem] rounded-xl items-center flex justify-center shadow-xl cursor-pointer -z-50">></div>
            <div class="relative h-[47.5rem] space-y-32">
                <div class=" h-[30rem] w-auto mx-2 mt-[6rem] flex flex-col justify-between">
                    <a href="DashboardAd.html" class="cursor-pointer mx-1 h-[50px] w-auto flex items-center hover:bg-[#f7997ae2]  rounded-2xl duration-200">
                        <img id="Logo" class="w-[60px] h-[55px]" src="img/dashboard.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Dashboard</h1>
                    </a>
                    <a class=" h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="OrderList.html">
                        <img class="w-[55px] h-[55px]" src="img/ordermenu.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Order</h1>
                    </a>
                    <a class="  h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="RequestList.html">
                        <img class="w-[55px] h-[55px]" src="img/request.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Request</h1>
                    </a>
                    <a class=" h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="AdminProducts.html">
                        <img class="w-[55px] h-[55px]" src="img/product.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Products</h1>   
                    </a>
                    <a class="relative h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2] rounded-2xl duration-200" href="Materials.html">
                        <img class="w-[55px] h-[55px]" src="img/materialslogo.png" alt=""></img>
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Materials</h1>
                    </a>
                    <a class="relative h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2] rounded-2xl duration-200" href="Inbox.html">
                            <img class="w-[55px] h-[55px]" src="img/mesage.png" alt=""></img>
                            <span id="notif-badge" class="absolute top-0 left-9 w-3 h-3 inline-flex items-center justify-center text-[8px] font-bold text-[#FFFFFF] bg-[#FF0000] rounded-full"></span>
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Message</h1>
                    </a>
                </div>
                <div class="relative bottom-0 h-[50px] w-auto mx-1">
                    <hr class=" w-auto border-1 border-outline mx-1">
                    <div class="flex items-center cursor-auto" onclick="LogOut()">
                        <img src="img//LogOuts.png" alt="" class="cursor-pointer h-[50px] w-[50px] mx-2">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold opacity-0">LogOut</h1>
                    </div>
                </div>
            </div>
            
            
        </div>
        <div class="h-[442px] w-auto ml-[9rem] mr-8 mt-14 flex space-x-16">
            <div class=" w-[508px] h-[442px] space-y-10">
                <div class="w-[508px] h-[198px] bg-Likha outline outline-1 outline-outline rounded-2xl flex flex-col items-center">
                    <h1 class="font-Montagu font-bold text-[26px] mt-3">Orders</h1>
                    <div class="flex mt-3">
                        <div class="bg-[#D9D9D9] h-[100px] aspect-square rounded-full flex flex-col items-center pt-5 space-y-2">
                            <h5 class="font-Montserrat font-semibold text-[12px]">All</h5>
                            <p id="All" class="font-Montserrat font-semibold text-[16px]">12345</p>
                        </div>
                        <div class="bg-[#D9D9D9] h-[100px] aspect-square rounded-full flex flex-col items-center pt-5 space-y-2">
                            <h5 class="font-Montserrat font-semibold text-[12px]">Confirmed</h5>
                            <p id="Confirmed" class="font-Montserrat font-semibold text-[16px]">12345</p>
                        </div>
                        <div class="bg-[#D9D9D9] h-[100px] aspect-square rounded-full flex flex-col items-center pt-5 space-y-2">
                            <h5 class="font-Montserrat font-semibold text-[12px]">Order Packed</h5>
                            <p id="OP" class="font-Montserrat font-semibold text-[16px]">12345</p>
                        </div>
                        <div class="bg-[#D9D9D9] h-[100px] aspect-square rounded-full flex flex-col items-center pt-5 space-y-2">
                            <h5 class="font-Montserrat font-semibold text-[12px]">To Pick Up</h5>
                            <p id="PU" class="font-Montserrat font-semibold text-[16px]">12345</p>
                        </div>
                    </div>


                </div>
                <div class="w-[508px] h-[198px] bg-Likha outline outline-1 outline-outline rounded-2xl flex flex-col items-center">
                    <h1 class="font-Montagu font-bold text-[26px] mt-3">Request</h1>
                    <div class="flex mt-3">
                        <div class="bg-[#D9D9D9] h-[100px] aspect-square rounded-full flex flex-col items-center pt-5 space-y-2">
                            <h5 class="font-Montserrat font-semibold text-[12px]">All</h5>
                            <p id="RALL" class="font-Montserrat font-semibold text-[16px]">12345</p>
                        </div>
                        <div class="bg-[#D9D9D9] h-[100px] aspect-square rounded-full flex flex-col items-center pt-5 space-y-2">
                            <h5 class="font-Montserrat font-semibold text-[12px]">Confirmed</h5>
                            <p id="RCON" class="font-Montserrat font-semibold text-[16px]">12345</p>
                        </div>
                        <div class="bg-[#D9D9D9] h-[100px] aspect-square rounded-full flex flex-col items-center pt-5 space-y-2">
                            <h5 class="font-Montserrat font-semibold text-[12px]">To Pick Up</h5>
                            <p id="RTPU" class="font-Montserrat font-semibold text-[16px]">12345</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-[329px] h-[442px] bg-sign rounded-2xl flex flex-col items-center">
                <h1 class="font-Montagu font-semibold text-[20px] w-[258px] text-center mt-2">Sold Out Products & Materials</h1>
                <hr class="w-[329px] border-[2px] border-outline">
                <div id="SoldOut" class="m-4 space-y-4 overflow-y-auto">

                </div>
            </div>
            <div class="w-[329px] h-[442px] bg-sign rounded-2xl flex flex-col items-center">
                <h1 class="font-Montagu font-semibold text-[20px] w-[258px] h-[60px] text-center mt-3 mb-3 flex justify-center items-center">Best Sellers</h1>
                <hr class="w-[329px] border-[2px] border-outline">
                <div id="Best" class="m-4 space-y-6 overflow-y-auto">

                </div>
                
            </div>
        </div>
        <div class="bg-[#F07C541A] w-auto h-auto pb-4 ml-[7rem] mr-8 mt-14 rounded-2xl pt-5">
            <div class="w-auto h-[45px] flex space-x-10 pl-20">
                <div id="RO" class="font-Inter font-semibold cursor-pointer">Recent Order</div>
                <div id="RR" class="font-Inter text-[#6B707B80] font-semibold cursor-pointer">Recent Request</div>
            </div>
            <div class="w-auto h-[51px] ml-10 mr-12 bg-[#F7F8EA] border-y-[1px] border-outline flex justify-around items-center">
                <h1 id="OI" class="font-Inter font-extrabold text-[#6B707B80]">OrderID</h1>
                <h1 id="ProdName" class="font-Inter font-extrabold text-[#6B707B80] mx-[64px]">Product</h1>
                <h1 id="Cat" class="font-Inter font-extrabold text-[#6B707B80]">Category</h1>
                <h1 id="Quantity" class="font-Inter font-extrabold text-[#6B707B80]">Quantity</h1>
                <h1 id="Price" class="font-Inter font-extrabold text-[#6B707B80]">Price</h1>
                <h1 id="Stat" class="font-Inter font-extrabold text-[#6B707B80]">Status</h1>
            </div>

            <div id="RecentOrder" class= "h-auto w-auto m-6 px-5 space-y-9">
                <div class="w-[1209px] h-[50px] bg-Likha rounded-2xl"></div>

            </div>
        </div>
    </div>
</body>
<script>

document.getElementById('RR').addEventListener('click', () => {
    document.getElementById('RR').classList.remove('text-[#6B707B80]');
    document.getElementById('RO').classList.add('text-[#6B707B80]');
    document.getElementById('OI').innerText = 'RequestID';
    document.getElementById('ProdName').classList.add('hidden');
    document.getElementById('Cat').classList.add('hidden');
    document.getElementById('Quantity').classList.add('hidden');
    Recent('Request');
});

document.getElementById('RO').addEventListener('click', () => {
    document.getElementById('RO').classList.remove('text-[#6B707B80]');
    document.getElementById('RR').classList.add('text-[#6B707B80]');
    document.getElementById('OI').innerText = 'OrderID';
    document.getElementById('ProdName').classList.remove('hidden');
    document.getElementById('Cat').classList.remove('hidden');
    document.getElementById('Quantity').classList.remove('hidden');
    Recent('Order');
});

document.addEventListener('DOMContentLoaded', (event) => {
    Recent('Order');
    window.location.reload;
});

function Recent(Type = '') {
    console.log(Type);
    fetch(`/RecentOrder?Type=${Type}`)
        .then(response => response.json())
        .then(data => {
            const RecentOrder = document.getElementById('RecentOrder');
            RecentOrder.innerHTML = ''; // Clear existing content

            // If Type is 'Request', use CustomItems, otherwise use Orders
            const dataToDisplay = Type === 'Request' ? data : data; // Simplified for clarity
            
            console.log('Fetched Data:', data);  // Check the full structure of data

            dataToDisplay.forEach(element => {
                const RecentOrderElements = document.createElement('div');
                if (Type === 'Request') {
                    // Show only TransactionID, Price, and Status for Request
                    RecentOrderElements.innerHTML = `
                        <div class="w-auto h-[50px] bg-Likha rounded-2xl flex justify-between relative items-center">
                            <div class="absolute left-[10.25rem]">
                                <h1>${element.TransactionID}</h1>
                            </div>
                            <div class=" absolute left-[31.15rem] w-[17rem]">
                                <h1 class="text-center">${element.Price}</h1>
                            </div>
                            <div class=" absolute left-[56.5rem] w-[17rem]">
                                <h1 class="text-center">${element.Status}</h1>
                            </div>
                        </div>
                    `;
                } else {
                    // Show full order details for Orders
                    RecentOrderElements.innerHTML = `
                        <div class="w-auto h-[50px] bg-Likha rounded-2xl flex justify-between relative items-center">
                            <div class="absolute left-[3rem]">
                                <h1>${element.TransactionID}</h1>
                            </div>
                            <div class="absolute left-[10rem] w-[22rem]">
                                <h1 class="text-center">${element.ProductName}</h1>
                            </div>
                            <div class=" absolute left-[28.75rem] w-[17.5rem]">
                                <h1 class="text-center">${element.CategoryName}</h1>
                            </div>
                            <div class=" absolute left-[41.5rem] w-[17rem]">
                                <h1 class="text-center">${element.Quantity}</h1>
                            </div>
                            <div class=" absolute left-[53rem] w-[17rem]">
                                <h1 class="text-center">${element.Price}</h1>
                            </div>
                            <div class=" absolute left-[63.75rem] w-[17rem]">
                                <h1 class="text-center">${element.Status}</h1>
                            </div>
                        </div>
                    `;
                }
                RecentOrder.appendChild(RecentOrderElements);
            });
        })
        .catch(error => console.error('Error fetching data:', error));
}



async function fetchUnreadCount() {
        try {
            const response = await fetch('/ChatNotif'); 
            const data = await response.json();
            const unreadCount = data.Notif;
            console.log(unreadCount);
            const notifBadge = document.getElementById('notif-badge');
            if (unreadCount > 0) {
                notifBadge.textContent = unreadCount;
                notifBadge.style.display = 'inline-flex';
            } else {
                notifBadge.style.display = 'none';
            }
        } catch (error) {
            console.error('Error fetching unread count:', error);
        }
    }


    document.addEventListener('DOMContentLoaded', fetchUnreadCount);


    setInterval(fetchUnreadCount, 2000); 


const SideBar = document.getElementById('SideBar');
const Open = document.getElementById('Open');
const Logo = document.getElementById('Logo');
const Brand = document.querySelectorAll('#Brand');

Open.addEventListener('click', function(event){
    SideBar.classList.add('transition-all', 'duration-500');
    if(SideBar.classList.contains('w-[80px]')){
        Brand.forEach(brand =>{brand.classList.remove('hidden')});
        Brand.forEach(brand =>{brand.classList.add('animation-fadeInLeft')});
        SideBar.classList.add('w-[350px]');
        SideBar.classList.remove('w-[80px]');
        Open.innerText = '<';
    }
    else if(SideBar.classList.contains('w-[350px]')){
        Brand.forEach(brand =>{brand.classList.remove('animation-fadeInLeft')});
        Brand.forEach(brand =>{brand.classList.add('hidden')});
        Brand.forEach(brand =>{brand.classList.add('animation-fadeInRight')});
        SideBar.classList.add('w-[80px]');
        SideBar.classList.remove('w-[350px]');
        Open.innerText = '>';
    }
});

    fetch('/Counts')
    .then(response => response.json())
    .then(data => {
        document.getElementById('All').innerText = data.orderCounts.All;
        document.getElementById('Confirmed').innerText = data.orderCounts.Confirmed;
        document.getElementById('OP').innerText = data.orderCounts.OrderPacked;
        document.getElementById('PU').innerText = data.orderCounts.ReadyToPickUp;
        document.getElementById('RALL').innerText = data.totalStatusCount;
        const RCON = data.customStatusCounts.find(item => item.Status === "Confirmed");
        document.getElementById('RCON').innerText = RCON ? RCON.count_per_status : 0;
        const RTPU = data.customStatusCounts.find(item => item.Status === "Ready for Pick Up");
        document.getElementById('RTPU').innerText = RTPU ? RTPU.count_per_status : 0;

        console.log(RTPU);

    })
    .catch(error => console.error('Error:', error));
    fetch('/SoldOut')
    .then(response => response.json())
    .then(data => {
        const List = document.getElementById('SoldOut');
        List.innerHTML = '';

        data.productsOutOfStock.forEach(list => {
            const ListElement = document.createElement('div');
            ListElement.innerHTML = `
                <div class="w-[280px] h-auto min-h-[72px] rounded-lg bg-Likha border-b-[5px] border-[#96A378] p-2 cursor-pointer">
                    <h6 class="font-Inter">${list.ProductName}
                    </h6>
                </div>
            `;
            List.appendChild(ListElement);
            ListElement.addEventListener('click', function(event){
                const Product = ListElement.querySelector('h6').innerText;
                sessionStorage.setItem('OoS', Product);
                window.location.href = 'EditProduct.html';
            })
        });
        data.materialsOutOfStock.forEach(item => {
        const materialElement = document.createElement('div');
        materialElement.innerHTML = `
            <div class="w-[280px] h-auto min-h-[72px] rounded-lg bg-Likha border-b-[5px] border-[#2596BE] p-2 cursor-pointer">
                <h6 class="font-Inter">${item.MaterialName}
                </h6>
            </div>
        `;
        List.appendChild(materialElement);
        materialElement.addEventListener('click', function(event){
                sessionStorage.setItem('MoS', item.MaterialID);
                window.location.href = 'EditMaterial.html';
            })
    });
    })
    .catch(error => console.error('Error fetching data:', error));
    fetch('/BestSeller')
    .then(response => response.json())
    .then(data => {
        const BestSeller = document.getElementById('Best');
        BestSeller.innerHTML = '';

        data.BestSeller.forEach(element => {
            const BestSellerElements = document.createElement('div');
            BestSellerElements.innerHTML = `
                <div class="w-[280px] h-auto min-h-[72px] bg-Likha rounded-xl p-2">
                    <h6 class="font-Inter">
                    ${element.ProductName} 
                    </h6>
                </div>
            `;
            BestSeller.appendChild(BestSellerElements);
        });
    }).catch(error => console.error('Error fetching data:', error));


</script>
<script src="AuthorizationBE.js"></script>
</html> 