<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Details</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="img/ZappnottLogo.png" type="image/icon">
</head>
<style>
    #Item-Con::-webkit-scrollbar{
        display: none;
    }
</style>
<body>
    <div class="bg-Likha h-[5rem] w-full shadow-md p-2.5 fixed z-50">
        <nav class="md:flex md:items-center">   
            <div >
                <img src="img/ZappnottLogo.png" alt="" class="h-[4rem] ml-[2rem] cursor-pointer md:cursor-default" onclick="Menu(this)" name = "menu" id="menubutton">
            </div>
            
            <div class="flex fixed p-3 top-1 right-1 md:right-16">
                <img id="Profile" class="cursor-pointer h-[3rem] w-[3rem]" src="img/PROFILE.png"  alt="">
            </div>
        </nav>
    </div>
    <div class="bg-Likha min-h-screen p-[5rem] pt-[9rem] space-y-12">
        <div id="Container" class="relative space-y-12">
               
        </div>
        
    </div>
    <div id="AdminMenu" class="bg-[#F8ECDC] outline hidden fixed outline-[3px] p-0 outline-outline w-[491px] h-[320px]  right-[0.15rem] top-[5.15rem] flex flex-col justify-evenly">
        <a href="OrderList.html" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
            <p class="font-Montserrat font-semibold">Order</p>
        </a>
        
        <a href="" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
            <p class="font-Montserrat font-semibold">Landing</p>
        </a>
        <a href="AdminHome.html" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
            <p class="font-Montserrat font-semibold">Home Page</p>
        </a>
        <a href="" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center">
            <p class="font-Montserrat font-semibold">3D Customization</p>
        </a>
        <a href="" class="text-center outline outline-1 pt-[20px] outline-outline h-[5rem] items-center" onclick="LogOut()">
            <p class="font-Montserrat font-semibold">Log Out</p>
        </a>
    </div>
    <div id="userInfo" class="hidden"></div>
</body>
<script>
    const ReqID = sessionStorage.getItem('RequestID');


    if (ReqID) {
    fetch(`/RequestDetails?req=${(ReqID)}`)
    .then(response => response.json())
    .then(Items => {
        console.log(Items);
        Items.forEach(Item => {
            const ItemList = document.getElementById('Container');
            const ItemElement = document.createElement('div');
            ItemElement.innerHTML = `
            <div class = "flex space-x-12 relative">
                <div class="flex flex-col relative">
                    <div id="Item-Con" class="w-[882px] relative overflow-y-auto h-[270px] outline outline-1 outline-outline bg-sign rounded-2xl">
                        <div class="w-[844px] pt-6 pl-[3.5rem] relative mx-auto mt-7 h-[101px] bg-outline rounded-2xl">
                            <p class="font-Inter font-extrabold text-[20px] text-[#FFFFFF]">${Item.productOrder}</p>
                            <p class="font-Montserrat font-semibold text-[14px] text-[#FFFFFF]">${Item.OrderedDate}</p>
                        </div>
                        <div class="flex items-center ml-[5rem] space-x-4 mt-[1.5rem]">
                            <img src="img/Folder.png" class="w-[80px]">
                            <a href="${Item.Image}">https://res.cloudinary.com</a>
                        </div>
                    </div>
                    <!-- Product dito then hr ulit -->
                    <div class="w-[882px] h-[213px] outline outline-1 outline-outline bg-sign mt-[3rem] space-x-3 rounded-2xl pt-4 flex items-center p-4">
                        <div class="w-[40rem] h-[10rem] space-y-3">
                            <div class="relative font-Inter font-extrabold text-xl text-[#00000080] left-[2rem]">Customer Details</div>
                            <h1 class="font-Inter font-bold text-xl text-[#000000] relative left-[2.5rem]">${Item.CustomerName}</h1>
                            <h2 class="font-Inter font-normal text-xl text-[#000000] relative left-[2.5rem]">${Item.CustomerEmail}</h2>
                            <h3 class="font-Inter font-normal text-xl text-[#000000] relative left-[2.5rem]">${Item.CustomerNum}</h3>
                        </div>
                        <a id="ViewPayment" href="https://dashboard.paymongo.com/payments/${Item.PaymentLink}" class="w-[325px] h-[70px] p-1 bg-outline rounded-[5px] absolute right-7 font-Inter text-[#FFFFFF] font-extrabold  flex items-center justify-center text-[20px]" target="_blank">View Payment</a>
                    </div>
                </div>
                
                <div class="space-y-4 bg-likha  ">
                    <div class="w-[396px] h-[359px] outline outline-1 pl-10 pt-5 outline-outline bg-sign rounded-2xl ">
                        <p class="font-Montserrat font-semibold text-[24px] text-[#00000080]">Request Status</p>
                        
                        <div class="w-[14rem] h-[14.5rem] flex flex-col mt-[2rem]">
                            <div id="Requested" class="flex items-center space-x-3 cursor-pointer">
                                <div class="bg-[#FFFFFF] rounded-full h-[20px] w-[20px] border-outline border-[3px] flex justify-center items-center">
                                    <div id="Req-Circle" class="w-[10px] h-[10px] bg-outline rounded-full"></div>
                                </div>
                                <p class="font-Montserrat text-[#F07C54CC]">Requested</p>
                            </div>
                            <div class="border-l-[1px] border-[#F07C54] h-[25px] ml-[9.25px] relative mt-0 mb-0"></div>
                            <div class="flex space-x-[4rem]">
                                <div id="Confirmed" class="flex items-center space-x-3 cursor-pointer">
                                    <div class="bg-[#FFFFFF] rounded-full h-[20px] w-[20px] border-outline border-[3px] flex justify-center items-center">
                                        <div id="Con-Circle" class="w-[10px] h-[10px] bg-outline rounded-full hidden"></div>
                                    </div>
                                    <p class="font-Montserrat text-[#F07C54CC]">Confirmed</p>
                                </div>
                                <div id="Decline" class="flex items-center space-x-3 cursor-pointer">
                                    <div class="bg-[#FFFFFF] rounded-full h-[20px] w-[20px] border-outline border-[3px] flex justify-center items-center">
                                        <div id="Decline-Circle" class="w-[10px] h-[10px] bg-outline rounded-full hidden"></div>
                                    </div>
                                    <p class="font-Montserrat text-[#F07C54CC]">Decline</p>
                                </div>
                            </div>    

                            <div class="border-l-[1px] border-[#F07C54] h-[25px] ml-[9.25px] relative mt-0 mb-0"></div>
                            <div id="Paid" class="flex items-center space-x-3 cursor-pointer">
                                <div class="bg-[#FFFFFF] rounded-full h-[20px] w-[20px] border-outline border-[3px] flex justify-center items-center">
                                    <div id="Paid-Circle" class="w-[10px] h-[10px] bg-outline rounded-full hidden"></div>
                                </div>
                                <p class="font-Montserrat text-[#F07C54CC]">Paid</p>
                            </div>
                            <div class="border-l-[1px] border-[#F07C54] h-[25px] ml-[9.25px] relative mt-0 mb-0"></div>
                            <div id="OP" class="flex items-center space-x-3 cursor-pointer">
                                <div class="bg-[#FFFFFF] rounded-full h-[20px] w-[20px] border-outline border-[3px] flex justify-center items-center">
                                    <div id="OP-Circle" class="w-[10px] h-[10px] bg-outline rounded-full hidden"></div>
                                </div>
                                <p class="font-Montserrat text-[#F07C54CC]">On Process</p>
                            </div>
                            <div class="border-l-[1px] border-[#F07C54] h-[25px] ml-[9.25px] relative mt-0 mb-0"></div>
                            <div id="RFP" class="flex items-center space-x-3 cursor-pointer">
                                <div class="bg-[#FFFFFF] rounded-full h-[20px] w-[20px] border-outline border-[3px] flex justify-center items-center">
                                    <div id="RFP-Circle" class="w-[10px] h-[10px] bg-outline rounded-full hidden"></div>
                                </div>
                                <p class="font-Montserrat text-[#F07C54CC]">Ready for Pickup</p>
                            </div>
                            <div class="border-l-[1px] border-[#F07C54] h-[25px] ml-[9.25px] relative mt-0 mb-0"></div>
                            <div id="Completed" class="flex items-center space-x-3 cursor-pointer">
                                <div class="bg-[#FFFFFF] rounded-full h-[20px] w-[20px] border-outline border-[3px] flex justify-center items-center">
                                    <div id="Com-Circle" class="w-[10px] h-[10px] bg-outline rounded-full hidden"></div>
                                </div>
                                <p class="font-Montserrat text-[#F07C54CC]">Completed</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="outline outline-1 outline-outline bg-sign space-y-4 p-[1rem] pt-[1.5rem] rounded-2xl w-[396px] h-[212px]">
                        <div class="flex space-x-[4.25rem]">
                            <p class="font-Montserrat ml-2 font-semibold text-xl text-[#00000080]">Total:</p>
                            <p class="font-Montserrat ml-2 font-semibold text-xl text-[#00000080]">${Item.ProductTotal}</p>
                        </div>
                        
                        <p class="font-Montserrat ml-2 font-semibold text-xl text-[#00000080]">Discount %:  </p>
                        <hr class="w-[300px] border-[#F07C54] border">
                        <p class="font-Montserrat ml-2 font-semibold text-xl text-[#00000080]">Order Total: ${Item.ProductTotal}</p>
                    </div>
                </div>
            </div>
            `;
            ItemList.appendChild(ItemElement);
            if(Item.PaymentLink == null){
                ItemElement.querySelector('#ViewPayment').classList.add('hidden');
            }

            document.getElementById('Requested').addEventListener('click', function () {
                fetch('/UpdateStatReq', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'Requested', TransID: Item.productOrder })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert('Order Packed: ' + data.message);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    location.reload();
            });
            
            document.getElementById('Confirmed').addEventListener('click', function () {
                fetch('/UpdateStatReq', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'Confirmed', TransID: Item.productOrder })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert('Order Packed: ' + data.message);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    location.reload();
            });
            document.getElementById('OP').addEventListener('click', function () {
                fetch('/UpdateStatReq', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'On Process', TransID: Item.productOrder })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert('Order Packed: ' + data.message);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    location.reload();
            });
            document.getElementById('RFP').addEventListener('click', function () {
                fetch('/UpdateStatReq', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'Ready for Pick Up', TransID: Item.productOrder })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert('Order Packed: ' + data.message);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    location.reload();
            });
            document.getElementById('Completed').addEventListener('click', function () {
                fetch('/UpdateStatReq', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'Completed', TransID: Item.productOrder })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert('Order Packed: ' + data.message);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    location.reload();
            });
            document.getElementById('Decline').addEventListener('click', function () {
                fetch('/UpdateStatReq', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ status: 'Declined', TransID: Item.productOrder })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert('Order Packed: ' + data.message);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                    location.reload();
            });

            async function checkStat(){
                const Status = Item.Status;

                if(Status === 'Requested'){
                    document.getElementById('Req-Circle').classList.remove('hidden');
                }
                else if(Status === 'Confirmed'){
                    document.getElementById('Req-Circle').classList.remove('hidden');
                    document.getElementById('Con-Circle').classList.remove('hidden');
                }
                else if(Status === 'Paid'){
                    document.getElementById('Req-Circle').classList.remove('hidden');
                    document.getElementById('Con-Circle').classList.remove('hidden');
                    document.getElementById('Paid-Circle').classList.remove('hidden');
                }
                else if(Status === 'On Process'){
                    document.getElementById('Req-Circle').classList.remove('hidden');
                    document.getElementById('Con-Circle').classList.remove('hidden');
                    document.getElementById('Paid-Circle').classList.remove('hidden');
                    document.getElementById('OP-Circle').classList.remove('hidden');
                }
                else if(Status === 'Ready for Pick Up'){
                    document.getElementById('Req-Circle').classList.remove('hidden');
                    document.getElementById('Con-Circle').classList.remove('hidden');
                    document.getElementById('Paid-Circle').classList.remove('hidden');
                    document.getElementById('OP-Circle').classList.remove('hidden');
                    document.getElementById('RFP-Circle').classList.remove('hidden');
                }
                else if(Status === 'Completed'){
                    document.getElementById('Req-Circle').classList.remove('hidden');
                    document.getElementById('Con-Circle').classList.remove('hidden');
                    document.getElementById('Paid-Circle').classList.remove('hidden');
                    document.getElementById('OP-Circle').classList.remove('hidden');
                    document.getElementById('RFP-Circle').classList.remove('hidden');
                    document.getElementById('Com-Circle').classList.remove('hidden');
                }
                else if(Status === 'Declined'){
                    document.getElementById('Req-Circle').classList.add('hidden');
                    document.getElementById('Con-Circle').classList.add('hidden');
                    document.getElementById('Paid-Circle').classList.add('hidden');
                    document.getElementById('OP-Circle').classList.add('hidden');
                    document.getElementById('RFP-Circle').classList.add('hidden');
                    document.getElementById('Com-Circle').classList.add('hidden');
                    document.getElementById('Decline-Circle').classList.remove('hidden');
                }
            }

            checkStat();
        });
    });

}else{
    console.error('No transacValue found in sessionStorage');
}

document.addEventListener('DOMContentLoaded', (event) => {
        const Profile = document.getElementById('Profile');
        const Menu = document.getElementById('AdminMenu');

        Profile.addEventListener('click', () => {

            if (!Menu.classList.contains('hidden')) {
                Menu.classList.add('hidden');
            } else {
                Menu.classList.remove('hidden');
            }
        });
    });
   
</script>
<script src="AuthorizationBE.js"></script>
<script src="AdminPage.js"></script>
</html>