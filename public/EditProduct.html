<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="img/ZappnottLogo.png" type="image/icon">
    <title>Edit Products</title>
</head>
<style>
        @keyframes fadeInRight {
    0% {
        opacity: 1;
        transform: translateX(0%);
    }
    100% {
        opacity: 0;
        transform: translateX(-15%);
    }
    }
    .animation-fadeInRight {
    animation: fadeInRight 0.15s ease-in-out forwards;
    }
    @keyframes fadeInLeft {
    0% {
        opacity: 0;
        transform: translateX(-40%);
    }
    100% {
        opacity: 1;
        transform: translateX(0);
    }
    }
    .animation-fadeInLeft {
    animation: fadeInLeft 0.5s ease-in-out forwards;
    }
</style>
<body>
    <div class="bg-Likha h-[5rem] w-full shadow-md p-2.5 fixed z-50">
        <nav class="md:flex md:items-center">   
            <div >
                <img src="img/ZappnottLogo.png" alt="" class="h-[4rem] ml-[2rem] cursor-pointer md:cursor-default" onclick="Menu(this)" name = "menu" id="menubutton">
            </div>

            <ul class="my-6 md:my-0 ml-10">
                <a href="Inbox.html" class="relative hover:text-outline duration-300">
                    CHAT
                    <!-- <span id="notif-badge" class="absolute top-0 right-[-1] inline-flex items-center justify-center py-1 text-xs font-bold leading-none text-sign bg-outline rounded-full"></span> -->
                </a>
            </ul>
            
            
            <div class="flex fixed p-3 top-1 right-1 md:right-16">
                <img id="Profile" class="cursor-pointer h-[3rem] w-[3rem]" src="img/PROFILE.png"  alt="">
            </div>
        </nav>
    </div>
    <div class="bg-Likha min-h-screen pt-[5rem] pb-[3rem]">
        <div id="SideBar" class="bg-[#F8ECDC] h-svh w-[80px] z-[1000] fixed flex flex-col">
            <div id="Open" class="bg-[#F8ECDC] w-[30px] h-[60px] absolute right-[-1.25rem] top-[23rem] rounded-xl items-center flex justify-center shadow-xl cursor-pointer -z-50">></div>
            <div class="relative h-[47.5rem] space-y-32">
                <div class=" h-[30rem] w-auto mx-2 mt-[6rem] flex flex-col justify-between">
                    <a href="DashboardAd.html" class="cursor-pointer mx-1 h-[50px] w-auto flex items-center hover:bg-[#f7997ae2]  rounded-2xl duration-200">
                        <img id="Logo" class="w-[60px] h-[55px]" src="img/dashboard.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Dashboard</h1>
                    </a>
                    <a class=" h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="OrderList.html">
                        <img class="w-[55px] h-[55px]" src="img/ordermenu.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Order</h1>
                    </a>
                    <a class="  h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="RequestList.html">
                        <img class="w-[55px] h-[55px]" src="img/request.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Request</h1>
                    </a>
                    <a class=" h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2]  rounded-2xl duration-200" href="AdminProducts.html">
                        <img class="w-[55px] h-[55px]" src="img/product.png" alt="">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Products</h1>   
                    </a>
                    <a class="relative h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2] rounded-2xl duration-200" href="Materials.html">
                        <img class="w-[55px] h-[55px]" src="img/materialslogo.png" alt=""></img>
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Materials</h1>
                    </a>
                    <a class="relative h-[50px] w-auto mx-1 flex items-center cursor-pointer hover:bg-[#f7997ae2] rounded-2xl duration-200" href="Inbox.html">
                            <img class="w-[55px] h-[55px]" src="img/mesage.png" alt=""></img>
                            <span id="notif-badge" class="absolute top-0 left-9 w-3 h-3 inline-flex items-center justify-center text-[8px] font-bold text-[#FFFFFF] bg-[#FF0000] rounded-full"></span>
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold hidden">Message</h1>
                    </a>
                </div>
                <div class="relative bottom-0 h-[50px] w-auto mx-1">
                    <hr class=" w-auto border-1 border-outline mx-1">
                    <div class="flex items-center cursor-auto" onclick="LogOut()">
                        <img src="img//LogOuts.png" alt="" class="cursor-pointer h-[50px] w-[50px] mx-2">
                        <h1 id="Brand" class="font-Montserrat text-[20px] font-semibold opacity-0">LogOut</h1>
                    </div>
                </div>
            </div>
            
            
        </div>
        
        <form  id="uploadForm" enctype="multipart/form-data" class="h-[55rem] w-[84rem] mt-[2.5rem] ml-[8rem] flex space-x-16">
            <div class="space-y-8">
                <div class="bg-[#F07C541A] w-[749px] h-[337px] rounded-xl shadow-md pl-6 pt-4 space-y-6">
                    <h1 class="font-Montagu font-bold text-[20px]">General Information</h1>
                    <div class="space-y-1">
                        <label class="text-[#6B707B80] font-Inter font-extrabold text-[15px]" for="newProductName">Product Name</label>
                        <input type="text" name="newProductName" id="newProductName" class="outline outline-[3px] bg-[#F7F8EA] outline-outline w-[671px] h-[51px] p-3 rounded-lg">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[#6B707B80] font-Inter font-extrabold text-[15px]" for="productDes">Description</label>
                        <textarea name="productDes" id="productDes" class="outline outline-[3px] outline-outline w-[671px] h-[109px] bg-[#F7F8EA] p-3 rounded-lg"></textarea>
                    </div>
                </div>
                <div class="bg-[#F07C541A] h-[277px] w-[749px] rounded-xl shadow-md pl-6 pt-4 space-y-4">
                    <h1 class="font-Montagu font-bold text-[20px]">Pricing</h1>
                    <div class="space-y-1">
                        <label class="text-[#6B707B80] font-Inter font-extrabold text-[15px]" for="productPrice">Base Price</label>
                        <div class="flex items-center border-[3px] border-outline rounded-lg  px-4 py-2  bg-[#F7F8EA] w-[671px] h-[51px]">
                            <span class="font-Inter font-extrabold mr-2">â‚±</span>
                            <input
                              type="number"
                              class="w-full  bg-[#F7F8EA]  focus:outline-none"
                              name="productPrice" id="productPrice"
                            />
                        </div>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[#6B707B80] font-Inter font-extrabold text-[15px]" for="productDiscount">Discount Percentage (%)</label>
                            <input
                              type="number"
                              class="outline outline-[3px] bg-[#F7F8EA] outline-outline w-[671px] h-[51px] p-3 rounded-lg"
                              name="productDiscount" id="productDiscount"
                            />
                    </div>
                </div>
                <div class="bg-[#F07C541A] h-[173px] w-[749px] rounded-xl shadow-md pl-6 pt-4 space-y-2">
                    <h1 class="font-Montagu font-bold text-[20px]">Stock</h1>
                    <div class="flex flex-col space-y-1">
                        <label class="text-[#6B707B80] font-Inter font-extrabold text-[15px]" for="Stock">Available Stocks</label>
                            <input
                              type="number"
                              class="outline outline-[3px] bg-[#F7F8EA] outline-outline w-[211px] h-[51px] p-3 rounded-lg"
                              name="Stock" id="Stock"
                           />
                     </div>
                </div>
            </div>
            <div class="space-y-8 w-[471px] h-[50rem] flex flex-col items-center relative">
                <div class="bg-[#F07C541A] h-[337px] w-[471px] rounded-xl shadow-md pl-6 pt-4">
                    <div class="space-y-4">
                        <h1 class="font-Montagu font-bold text-[20px]">Product Media</h1>
                        <div class="space-y-1">
                            <h2 class="font-Inter font-extrabold text-[15px] text-[#6B707B80]">Product Photo</h2>
                            <div class="outline-dashed outline-[3px] outline-outline bg-[#F7F8EA] w-[375px] h-[177px] rounded-2xl relative left-1/2 -translate-x-1/2 flex items-center justify-center">
                                <label for="file-upload" class="flex items-center cursor-pointer bg-[#F7F8EA] outline outline-[3px] outline-outline w-[150px] h-[150px] rounded-xl">
                                    <img id="previewImage" src="img/+.png" alt="" class="mx-auto w-[150px] aspect-square rounded-xl">
                                </label>
                                <input id="file-upload" type="file" class="hidden" name="image" onchange="previewFile()" accept="image/png, image/jpeg">
                            </div>

                        </div>
                        
                    </div>
                </div>
                <div class="bg-[#F07C541A] h-[169px] w-[471px] rounded-xl shadow-md pl-6 pt-4 space-y-[1.5px]">
                    <h1 class="font-Montagu font-bold text-[20px]">Category</h1>
                    <div class="space-y-1">
                        <label class="text-[#6B707B80] font-Inter font-extrabold text-[15px]" for="Cat">Product Category</label>
                        <select class="rounded-lg font-Montagu bg-[#F7F8EA] w-[430px] h-[51px] outline outline-[3px] p-1  outline-outline" name="Cat" id="Cat">
                            <option value="1">Bag</option>
                            <option value="2">Dress</option>
                            <option value="3">Jewelry</option>
                        </select>
                    </div>

                </div>
                <button class="bg-[#F07C54] w-[355px] h-[51px] rounded-3xl text-[#FFFFFF] font-Inter font-extrabold mx-auto absolute bottom-0">UPDATE</button>
            </div>
        </form>
        <div id="Loader" class="fixed hidden top-[20rem] z-[1001] right-[37%] bg-[#F8ECDC] w-[350px] h-[220px] text-white  rounded shadow-lg  transform translate-y-4 transition-all duration-300">
            <div class="flex relative justify-center top-1/2 -translate-y-1/2">
                <div class="flex flex-col space-y-5 justify-center items-center mx-[3rem] my-4">
                    <svg class="animate-spin h-16 w-16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="#f17d55" stroke-width="4"></circle>
                        <path class="opacity-75" fill="#f17d55"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                </div>
            </div>
        </div>
        <div id="Overlay" class="z-[1000] hidden bg-[#333333]  fixed h-[100%] w-[100%] pointer-events-none top-0 left-0 opacity-35"></div>
        <div id="successfully" class="fixed flex flex-col items-center top-[20rem] z-[1001] right-[37%] bg-[#F8ECDC] w-[350px] h-[220px] text-white rounded shadow-lg  transform translate-y-4 transition-all duration-300 hidden">
            <img src="https://res.cloudinary.com/db5bsftqx/image/upload/f_auto/c_crop,w_300,h_300,ar_1:1/v1727603906/Checked_ol98y2.png" alt="" class="w-[130px] aspect-square">
            <h1 class="font-Montserrat font-bold">Product updated successfully</h1>
            <button id="ok" onclick="AddOk()" class=" mt-3 bg-outline  text-[#FFF] rounded-3xl w-20">OK</button>
        </div>
    </div>
</body>
<script>
async function fetchUnreadCount() {
        try {
            const response = await fetch('/ChatNotif'); 
            const data = await response.json();
            const unreadCount = data.Notif;
            console.log(unreadCount);
            const notifBadge = document.getElementById('notif-badge');
            if (unreadCount > 0) {
                notifBadge.textContent = unreadCount;
                notifBadge.style.display = 'inline-flex';
            } else {
                notifBadge.style.display = 'none';
            }
        } catch (error) {
            console.error('Error fetching unread count:', error);
        }
    }


    document.addEventListener('DOMContentLoaded', fetchUnreadCount);


    setInterval(fetchUnreadCount, 2000); 


const SideBar = document.getElementById('SideBar');
const Open = document.getElementById('Open');
const Logo = document.getElementById('Logo');
const Brand = document.querySelectorAll('#Brand');

Open.addEventListener('click', function(event){
    SideBar.classList.add('transition-all', 'duration-500');
    if(SideBar.classList.contains('w-[80px]')){
        Brand.forEach(brand =>{brand.classList.remove('hidden')});
        Brand.forEach(brand =>{brand.classList.add('animation-fadeInLeft')});
        SideBar.classList.add('w-[350px]');
        SideBar.classList.remove('w-[80px]');
        Open.innerText = '<';
    }
    else if(SideBar.classList.contains('w-[350px]')){
        Brand.forEach(brand =>{brand.classList.remove('animation-fadeInLeft')});
        Brand.forEach(brand =>{brand.classList.add('hidden')});
        Brand.forEach(brand =>{brand.classList.add('animation-fadeInRight')});
        SideBar.classList.add('w-[80px]');
        SideBar.classList.remove('w-[350px]');
        Open.innerText = '>';
    }
});
    const product = sessionStorage.getItem('editProduct');
    const productsOutOfStock = sessionStorage.getItem('OoS');
    if(product !== null){
        fetch(`/Edit/${encodeURIComponent(product)}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('newProductName').value = data[0].productName;
            document.getElementById('productDes').value = data[0].description;
            document.getElementById('Cat').value = data[0].categoryID;
            document.getElementById('productPrice').value = data[0].productPrice;
            document.getElementById('productDiscount').value = data[0].discount;
            document.getElementById('Stock').value = data[0].stock;
            document.getElementById('previewImage').src = data[0].imagePath;
        })
        .catch(error => console.error('Error fetching product:', error));
        sessionStorage.removeItem('editProduct');
    }
    else if(productsOutOfStock !==null){
        fetch(`/Edit/${encodeURIComponent(productsOutOfStock)}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('newProductName').value = data[0].productName;
            document.getElementById('productDes').value = data[0].description;
            document.getElementById('Cat').value = data[0].categoryID;
            document.getElementById('productPrice').value = data[0].productPrice;
            document.getElementById('productDiscount').value = data[0].discount;
            document.getElementById('Stock').value = data[0].stock;
            document.getElementById('previewImage').src = data[0].imagePath;
        })
        .catch(error => console.error('Error fetching product:', error));

        const stockInput = document.getElementById('Stock');
        if (stockInput) {
            stockInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            stockInput.classList.add('highlight');
        }
        sessionStorage.removeItem('OoS');
    }

    const Form = document.querySelector('#uploadForm')
    Form.addEventListener('submit', async function(event) {
    event.preventDefault();
    const prodName = document.getElementById('newProductName').value;
    const prodDes =  document.getElementById('productDes').value;
    const Cat = document.getElementById('Cat').value;
    const Price = document.getElementById('productPrice').value;
    const Discount = document.getElementById('productDiscount').value;
    const Stock = document.getElementById('Stock').value;
    const Image = document.getElementById('previewImage').src;
    const formData = new FormData(this);
    console.log(formData);
    console.log(formData.get('image'));
    document.getElementById('Loader').classList.remove('hidden');
    document.getElementById('Overlay').classList.remove('hidden');
    const response = await fetch(`/updateProduct/${encodeURIComponent(product || productsOutOfStock)}`, {
        method: 'PUT',
        body: formData
    });

    if (response.ok) {
        document.getElementById('Loader').classList.add('hidden');
        document.getElementById('Overlay').classList.add('hidden');
        document.getElementById('successfully').classList.remove('hidden');
        //window.location.href= 'AdminProducts.html';
    } else {
        console.log("Error uploading");
    }
});
    function previewFile() {
        var preview = document.getElementById('previewImage');
        var file = document.querySelector('input[type=file]').files[0];
        var reader = new FileReader();

        reader.onloadend = function() {
            preview.src = reader.result;
        }

        if (file) {
            reader.readAsDataURL(file);
        } else {
            preview.src = "img/+.png"; 
        }
    }
    function AddOk(){
    document.getElementById('successfully').classList.add('hidden');
    window.location.href = document.referrer;

}
</script>
<style>
    .highlight {
        animation: shake 0.5s ease;
    }
    
    @keyframes shake {
        0% { transform: scale(1); }
        25% { transform: scale(1.05); }
        50% { transform: scale(1); }
        75% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    </style>    
</html>